"use strict";(self.webpackChunkfigurawiki=self.webpackChunkfigurawiki||[]).push([[3636],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>k});var r=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=r.createContext({}),u=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=u(e.components);return r.createElement(o.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,l=e.mdxType,a=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(n),p=l,k=c["".concat(o,".").concat(p)]||c[p]||h[p]||a;return n?r.createElement(k,i(i({ref:t},d),{},{components:n})):r.createElement(k,i({ref:t},d))}));function k(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var a=n.length,i=new Array(a);i[0]=p;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:l,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2394:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),l=(n(7294),n(3905));const a={},i=void 0,s={unversionedId:"globals/Events/Events",id:"globals/Events/Events",title:"Events",description:"Events are special functions that run at specific times or from specific triggers.",source:"@site/docs/globals/Events/Events.md",sourceDirName:"globals/Events",slug:"/globals/Events/",permalink:"/globals/Events/",draft:!1,editUrl:"https://github.com/figuramc/wiki/tree/main/docs/globals/Events/Events.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Config",permalink:"/globals/Config/"},next:{title:"Event",permalink:"/globals/Events/Event"}},o={},u=[{value:"Init",id:"init",level:3},{value:"Entity Init",id:"entity-init",level:3},{value:"Tick",id:"tick",level:3},{value:"World Tick",id:"world-tick",level:3},{value:"Render",id:"render",level:3},{value:"Post Render",id:"post-render",level:3},{value:"World Render",id:"world-render",level:3},{value:"Post World Render",id:"post-world-render",level:3},{value:"Chat Send Message",id:"chat-send-message",level:3},{value:"Chat Receive Message",id:"chat-receive-message",level:3},{value:"Skull Render",id:"skull-render",level:3},{value:"Mouse Scroll",id:"mouse-scroll",level:3},{value:"Mouse Move",id:"mouse-move",level:3},{value:"Mouse Press",id:"mouse-press",level:3},{value:"Key Press",id:"key-press",level:3},{value:"Char Typed",id:"char-typed",level:3},{value:"Use Item",id:"use-item",level:3},{value:"Arrow Render",id:"arrow-render",level:3},{value:"Item Render",id:"item-render",level:3},{value:"On Play Sound",id:"on-play-sound",level:3},{value:"Resource Reload",id:"resource-reload",level:3},{value:"Safely Calling Player",id:"safely-calling-player",level:3}],d={toc:u},c="wrapper";function h(e){let{components:t,...n}=e;return(0,l.kt)(c,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Events are special functions that run at specific times or from specific triggers."),(0,l.kt)("h3",{id:"init"},"Init"),(0,l.kt)("p",null,"If code is run outside of any event or function that is the ",(0,l.kt)("code",null,"init")," phase, and it runs first before any other event. Calling the player API will error here, use entity_init instead."),(0,l.kt)("h3",{id:"entity-init"},"Entity Init"),(0,l.kt)("p",null,"The entity_init event runs when the avatar's entity (usually the player) first starts existing."),(0,l.kt)("p",null,"It runs once and has no arguments. Calling the player API is safe here, making it a player-oriented init method."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.entity_init()\n    log("The player api has loaded!")\nend\n')),(0,l.kt)("h3",{id:"tick"},"Tick"),(0,l.kt)("p",null,"The tick event runs every in-game tick if the avatar's entity (the player) exists. There are 20 ticks in a second. This is the most commonly used event."),(0,l.kt)("p",null,"Tick has no arguments and calling the player API is safe here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.tick()\n    log("A tick has passed")\nend\n')),(0,l.kt)("h3",{id:"world-tick"},"World Tick"),(0,l.kt)("p",null,"The world_tick event runs every in game tick. There are 20 ticks in a second."),(0,l.kt)("p",null,"World_tick has no arguments and calling the player API without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.world_tick()\n    log("A tick has passed")\nend\n')),(0,l.kt)("h3",{id:"render"},"Render"),(0,l.kt)("p",null,"The render event runs once a frame before the avatar is rendered, after the avatar's entity exists. Calling the player is safe here."),(0,l.kt)("p",null,"Render has three parameters, all parameters are optional."),(0,l.kt)("p",null,"The first is delta, which is a number from 0 to 1 indicating the time between ticks (so at the start of a tick it always resets to 0). Delta is most often used to smooth values Minecraft updates once a tick."),(0,l.kt)("p",null,"The second parameter is the context of the current render mode. IE: If you're in first person you're viewing the FIRST_PERSON context, but if you have the paperdoll on you also have the PAPERDOLL context."),(0,l.kt)("p",null,"The third is the source matrix used to render the avatar. Because of a Minecraft bug this matrix will be NaN when moving very fast like when elytra flying."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.render(delta,context,matrix)\n    log("The render context is... "..context)\nend\n')),(0,l.kt)("h3",{id:"post-render"},"Post Render"),(0,l.kt)("p",null,"The render event runs once a frame after the avatar is rendered, after the avatar's entity exists. Calling the player is safe here."),(0,l.kt)("p",null,"It has the same parameters as render"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.post_render(delta,context,matrix)\n    log("The render context is... "..context)\nend\n')),(0,l.kt)("h3",{id:"world-render"},"World Render"),(0,l.kt)("p",null,"The world_render event is run every frame before the world is rendered. Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"Its only parameter is delta"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.world_render(delta)\n    log("A frame has passed!")\nend\n')),(0,l.kt)("h3",{id:"post-world-render"},"Post World Render"),(0,l.kt)("p",null,"The world_render event is run every frame after the world is rendered. Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"Its only parameter is delta"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.post_world_render(delta)\n    log("A frame has passed!")\nend\n')),(0,l.kt)("h3",{id:"chat-send-message"},"Chat Send Message"),(0,l.kt)("p",null,"The CHAT_SEND_MESSAGE event is run every time you send a message in chat"),(0,l.kt)("p",null,"A string parameter is passed in, which contains the message that was sent"),(0,l.kt)("p",null,"The return value is chained to the next events of the same type, whereas NIL cancels the message from being sent and any other value will modify the sent message (if allowed in the settings)"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.chat_send_message(msg)\n    host:setActionbar(msg)\n    return true\n    -- allows the message to be sent\nend\n")),(0,l.kt)("h3",{id:"chat-receive-message"},"Chat Receive Message"),(0,l.kt)("p",null,"The CHAT_RECEIVE_MESSAGE event is run every time a message is received in chat"),(0,l.kt)("p",null,"The first argument is the raw string of the received text"),(0,l.kt)("p",null,"The second argument is a JSON string representation of the received text"),(0,l.kt)("p",null,"If the first return value is not nil, the message will be replaced with that value"),(0,l.kt)("p",null,"If the first return value is false, it will suppress adding this message"),(0,l.kt)("p",null,"The second return value is, optionally, a RGB vector which will be used as background color for this message"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.chat_receive_message(raw,text)\n    host:setActionbar(raw)\n    -- logs are useful for visualizing when an event is running but doing it here is a bad idea\nend\n")),(0,l.kt)("h3",{id:"skull-render"},"Skull Render"),(0,l.kt)("p",null,"Called on every one of your skull blocks placed in the world"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"It have 5 arguments, as listed below:"),(0,l.kt)("p",null,"(number) - the tick delta"),(0,l.kt)("p",null,"(blockstate) - the block, when rendered from a block"),(0,l.kt)("p",null,"(itemstack) - the item, when rendered from an item"),(0,l.kt)("p",null,"(entity) - the entity, when rendered from a entity"),(0,l.kt)("p",null,"(string) - the type of the rendering (LEFT_HAND, HEAD, BLOCK, ...)"),(0,l.kt)("p",null,"If the return value is true, the skull will not render"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.skull_render(delta,block,item,entity,mode)\n   log("The rendering mode of this skull is... "..mode)\nend\n')),(0,l.kt)("h3",{id:"mouse-scroll"},"Mouse Scroll"),(0,l.kt)("p",null,"The MOUSE_SCROLL event runs every time the mouse is scrolled"),(0,l.kt)("p",null,"Takes a parameter delta, which is the direction of the scroll"),(0,l.kt)("p",null,"If returned true, the event cancels its vanilla function"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.mouse_scroll(delta)\n    log(delta)\nend\n")),(0,l.kt)("h3",{id:"mouse-move"},"Mouse Move"),(0,l.kt)("p",null,"The MOUSE_MOVE event runs every time the mouse is moved around"),(0,l.kt)("p",null,"Takes two parameters, x and y, which is the difference from the mouse position based on the latest saved position"),(0,l.kt)("p",null,"If returned true, the event cancels its vanilla function"),(0,l.kt)("p",null,"Note that cancelling the vanilla function also cancels saving the last mouse position"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.mouse_move(x,y)\n    log(x,y)\nend\n")),(0,l.kt)("h3",{id:"mouse-press"},"Mouse Press"),(0,l.kt)("p",null,"The MOUSE_PRESS event runs every time a mouse button is pressed"),(0,l.kt)("p",null,'Takes three number parameters, a "button", which is the number id of the button that was been pressed, the "action", which is the status of the press event (0 for release, 1 for press, 2 for hold), and the "modifier", which is a bitmask number detecting if you have any modifier keys being pressed (like shift or alt, for example)'),(0,l.kt)("p",null,"If returned true, the event cancels its vanilla function"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"The hold action is non-functional in mouse_press. Check the ",(0,l.kt)("a",{parentName:"p",href:"../tutorials/Keybinds"},"keybind API")," for an alternative to mouse_press."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.mouse_press(button,action,modifier)\n    log(button)\nend\n")),(0,l.kt)("h3",{id:"key-press"},"Key Press"),(0,l.kt)("p",null,'The key_press event runs every time a keyboard key is pressed\nTakes three number parameters, a "key", which is the number id of the key that was been pressed, the "action", which is the status of the press event (0 for release, 1 for press, 2 for hold), and the "modifier", which is a bitmask number detecting if you have any modifier keys being pressed (like shift or alt, for example)'),(0,l.kt)("p",null,"If returned true, the event cancels its vanilla function"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"Check the ",(0,l.kt)("a",{parentName:"p",href:"../tutorials/Keybinds"},"keybind API")," for an alternative to key_press."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.key_press(key,action,modifier)\n    log(key)\nend\n")),(0,l.kt)("h3",{id:"char-typed"},"Char Typed"),(0,l.kt)("p",null,"The char_typed event runs every time a character is inputted"),(0,l.kt)("p",null,'Takes three parameters, the resulting "string" after converting the code point, the "modifier", which is a bitmask number detecting if you have any modifier keys being pressed (like shift or alt, for example), and the "codepoint" of the inputted char'),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.char_typed(character,modifier,codepoint)\n    log(character.." was typed!")\nend\n')),(0,l.kt)("h3",{id:"use-item"},"Use Item"),(0,l.kt)("p",null,"The use_item event is run every time the entity uses an item"),(0,l.kt)("p",null,"The item, action and amount of particles this item would produce is given as argument"),(0,l.kt)("p",null,"If returned true, the event cancels its vanilla function"),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"Note: This event is several ticks slower than its alternative function in the ",(0,l.kt)("a",{parentName:"p",href:"../globals/Player#isusingitem"},"player API"),": ",(0,l.kt)("code",null,"player:isUsingItem()")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.use_item(item,action,particles)\n   log(item)\nend\n")),(0,l.kt)("h3",{id:"arrow-render"},"Arrow Render"),(0,l.kt)("p",null,"The ARROW_RENDER event is run for every arrow entity shot by the Avatar owner"),(0,l.kt)("p",null,"It takes two arguments, the tick delta, and the arrow entity- which contains all of the arrow's information like its position, or its type."),(0,l.kt)("p",null,'Returning "true" stops this arrow from rendering, including the Arrow parent parts'),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.arrow_render(delta,arrow)\n    log(arrow)\nend\n")),(0,l.kt)("h3",{id:"item-render"},"Item Render"),(0,l.kt)("p",null,"Called on every one of your items that is being rendered"),(0,l.kt)("p",null,"It takes six arguments, the item, the rendering mode, the position, rotation and scale that it would be applied, and if its being rendered from the left hand"),(0,l.kt)("p",null,"Returning a ModelPart parented to Item, stops the rendering of this item and will render the returned part instead."),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("p",null,"See the ",(0,l.kt)("a",{parentName:"p",href:"../tutorials/Custom-Items"},"custom items page")," for a more in-depth explanation."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.item_render(item,mode,pos,rot,scale,left)\n    log(item)\nend\n")),(0,l.kt)("h3",{id:"on-play-sound"},"On Play Sound"),(0,l.kt)("p",null,"The on_play_sound event runs every time you hear a sound."),(0,l.kt)("p",null,"Take as arguments, the sound ID, its world position, volume, pitch, if the sound should loop, the sound category, and the sound file path."),(0,l.kt)("p",null,"The file path will always be nil when hearing sounds played by Figura avatars."),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},"function events.on_play_sound(id,pos,vol,pitch,loop,category,path)\n    log(id)\nend\n")),(0,l.kt)("h3",{id:"resource-reload"},"Resource Reload"),(0,l.kt)("p",null,"Called every time that the client resources are reloaded, allowing you to re-create or update resource texture references."),(0,l.kt)("p",null,"Calling the player without a ",(0,l.kt)("code",null,"player:isLoaded()")," check will error here."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.resource_reload()\n    log("Resources reloaded")\nend\n')),(0,l.kt)("h3",{id:"safely-calling-player"},"Safely Calling Player"),(0,l.kt)("p",null,"The easiest way to blanket-protect an entire event (or any function like a ping) against the entity init error caused by calling the player API when it doesn't exist is to exit the function at the beginning of the event with this:"),(0,l.kt)("code",null,"if not player:isLoaded() then return end"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-lua"},'function events.item_render()\n    if not player:isLoaded() then return end\n    log("An item is being held (and the player API has loaded)")\nend\n')),(0,l.kt)("p",null,"Otherwise you can use an if statement if you want to protect only a portion of the code."))}h.isMDXComponent=!0}}]);