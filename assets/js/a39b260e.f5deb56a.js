"use strict";(self.webpackChunkfigurawiki=self.webpackChunkfigurawiki||[]).push([[732],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=c(n),p=i,g=d["".concat(s,".").concat(p)]||d[p]||h[p]||l;return n?a.createElement(g,r(r({ref:t},u),{},{components:n})):a.createElement(g,r({ref:t},u))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,r=new Array(l);r[0]=p;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[d]="string"==typeof e?e:i,r[1]=o;for(var c=2;c<l;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3887:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>c});var a=n(7462),i=(n(7294),n(3905));const l={},r=void 0,o={unversionedId:"tutorials/Pings",id:"tutorials/Pings",title:"Pings",description:"With normal mods, there is comunication between the Minecraft Server and it's clients which allows everything to stay in sync.",source:"@site/docs/tutorials/Pings.md",sourceDirName:"tutorials",slug:"/tutorials/Pings",permalink:"/tutorials/Pings",draft:!1,editUrl:"https://github.com/figuramc/wiki/tree/main/docs/tutorials/Pings.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Particles",permalink:"/tutorials/Particles"},next:{title:"Sounds",permalink:"/tutorials/Sounds"}},s={},c=[{value:"General Pings",id:"general-pings",level:2},{value:"Ping Rate Limiting",id:"ping-rate-limiting",level:3},{value:"Pingable Values",id:"pingable-values",level:3},{value:"Ping",id:"ping",level:3},{value:"Advanced Pings",id:"advanced-pings",level:2},{value:"Ping on Init",id:"ping-on-init",level:3},{value:"Byte Array",id:"byte-array",level:3}],u={toc:c},d="wrapper";function h(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"With normal mods, there is comunication between the Minecraft Server and it's clients which allows everything to stay in sync. ",(0,i.kt)("br",null),"\nFigura is completely client-side. It will never comunicate with the Minecraft Server you are connected to. Figura does not have a server-side component, meaning nothing will happen if you put the mod on a server.",(0,i.kt)("br",null)),(0,i.kt)("p",null,"What does this mean for you, the user? It means that certain functionality that only your client has access to will not be synced with other players.",(0,i.kt)("br",null),"\nSome examples:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Keybinds",(0,i.kt)("br",null),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"If the Minecraft Server tracked every single keystroke, it would be a major security issue. The exact keystrokes are never sent, only the result of those keystrokes."))),(0,i.kt)("li",{parentName:"ul"},"Action Wheel",(0,i.kt)("br",null),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The Action Wheel is a feature added by Figura. Remember how I said that Figura never comunicates with the Minecraft Server? It should be obvious why the Action Wheel isnt synced."))),(0,i.kt)("li",{parentName:"ul"},"HostAPI",(0,i.kt)("br",null),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"The HostAPI exclusivly contains variables that only you, the owner of the avatar and the owner of the machine running Minecraft, has access to. All functions contained within are vanilla variables that are not synced with the Minecraft Server. They are wrapped in a nice, explicit package stating that they are never synced. This is unlike the PlayerAPI, which you can assume is always synced (to some extent (I'm looking at you ",(0,i.kt)("code",null,"isGrounded"),"))")))),(0,i.kt)("p",null,"So how can we sync information with other players if we cannot do it through the Minecraft Server? The answer is Pings.",(0,i.kt)("br",null)),(0,i.kt)("h2",{id:"general-pings"},"General Pings"),(0,i.kt)("p",null,"Pings utilize Figura's Backend to sync information with other clients.",(0,i.kt)("br",null),"\nPings are functions that when called, triggers all other clients to call the same function for their instance of your avatar."),(0,i.kt)("h3",{id:"ping-rate-limiting"},"Ping Rate Limiting"),(0,i.kt)("p",null,"The backend restricts you on how much data you can send over a period of time.",(0,i.kt)("br",null),"\nThe developer given limits are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"1024 bytes per second"),(0,i.kt)("li",{parentName:"ul"},"32 pings per second")),(0,i.kt)("p",null,"If either of these are reached, the backend will ignore any comunication from you for some amount of time."),(0,i.kt)("h3",{id:"pingable-values"},"Pingable Values"),(0,i.kt)("p",null,"Pings can send most primitive types and some userdata types.",(0,i.kt)("br",null),"\nAll pingable types use a single byte to represent the type of data that is being sent. This byte is not included in the listed byte totals."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"nil")," - 0 Bytes - if a type that is not supported is used as a parameter, it will be replaced with ",(0,i.kt)("code",null,"nil"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"boolean")," - 0 Bytes"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"integear")," - 1-4 Bytes - ",(0,i.kt)("code",null,"integears")," only take up as many bytes as it needs. - ",(0,i.kt)("code",null,"integears")," are signed. For example, to only use a single byte the value must be between -128 and 127."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"double")," - 8 Bytes - If the number has a decimal at all, or is outside the range of a 4 byte ",(0,i.kt)("code",null,"integear"),", it will be sent as a ",(0,i.kt)("code",null,"double"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"string")," - 2+n Bytes - ",(0,i.kt)("code",null,"strings")," will always use 2 bytes to store the length. - Ascii characters will be a single byte each. - UTF-8 characters will be multiple bytes per character. - The absolute maximum size of string you can send is ",(0,i.kt)("code",null,"65535")," characters. If a larger string is sent, it will be truncated."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"table")," - Too Many Bytes - Every key and value is send as data, resulting in high byte costs. - It is recommended to never send a table over pings."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"VectorN")," - 1+8\\*N Bytes - Vectors have a single byte that stores the size of the Vector. - Vectors are always assumed to store ",(0,i.kt)("code",null,"doubles"),". If you have a Vector of integears, I recommend sending them as 3 seperate arguments instead."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("code",null,"MatrixN")," - 2+8\\*W\\*H Bytes - Matrices store both the width and height of the matrix, then every value as a ",(0,i.kt)("code",null,"double"),".")),(0,i.kt)("h3",{id:"ping"},"Ping"),(0,i.kt)("p",null,"Below is an example ping."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function pings.pingName(a)\n    print("Ping")\n    print(".")\n    print("Data Recieved:", a)\n    print(".")\n    print("Pong")\nend\n')),(0,i.kt)("p",null,"It accepts a single variable, which it will print to the chat as an example."),(0,i.kt)("p",null,"To call it, just call it like any other lua function."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'pings.pingName("This is a string wooooooooooooooooo")\n')),(0,i.kt)("p",null,"When you as the host call the ping, the function will execute for all other clients, regardless of their current state."),(0,i.kt)("p",null,"Do note that if a non-host client reaches a line where a ping gets called, it is completely ignored. No data is sent to the backend, and the contents of the ping will not be executed."),(0,i.kt)("p",null,"Ping functions can be passed into functions that expect a function as a parameter, such as Action ",(0,i.kt)("code",null,"onToggle"),". "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"actionVariable:onToggle(pings.pingName)\n")),(0,i.kt)("p",null,"Remember that we are passing the function itself as a variable. The below would be passing the ",(0,i.kt)("em",{parentName:"p"},"return result")," of the ping function, which is nigh guarenteed to be ",(0,i.kt)("code",null,"nil")," as Pings ",(0,i.kt)("em",{parentName:"p"},"should never")," return a value."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},"--do not do\nactionVariable:onToggle(pings.pingName())\n")),(0,i.kt)("h2",{id:"advanced-pings"},"Advanced Pings"),(0,i.kt)("p",null,"Situational techniques that may be handy, depending on the use case."),(0,i.kt)("h3",{id:"ping-on-init"},"Ping on Init"),(0,i.kt)("p",null,"Calling a ping function when the script is first loaded is a horrible idea. The ping will only ever execute for other clients when you, the host, load the avatar. Not only that, it may never be executed on other clients, as they might not have your avatar loaded by the time you broadcast the ping."),(0,i.kt)("p",null,"How do we get around this? Well, when you assign a function to an index in the ",(0,i.kt)("code",null,"pings")," table, the Lua Function gets replaced with a Java Function. This happens because of metatables, specifically the ",(0,i.kt)("code",null,"__newindex")," metamethod. Functions cannot be modified, so if we store the function before assing it to the ",(0,i.kt)("code",null,"pings")," table, we can use it like a regular function, and use the same code as a ping function."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'local function doThing(state)\n    models.modelA:setVisible(state)\n    models.modelB:setVisible(not state)\nend\npings.doThing = doThing\n-- doThing and pings.doThing are 2 completely seperate values at this point, as the pings table has replaced the index at pings.doThing with a Java Function that wraps the doThing Lua Function.\n-- <code>doThing==pings.doThing</code> will return <code>false</code>\nprint(doThing, pings.doThing, doThing==pings.doThing)\n\nlocal keybindState = false\n-- I call the local doThing instead of pings.doThing, as pings.doThing is a function that invokes network code.\n-- This ensures that the default state is set correctly. If this was a ping function, both models will be visible for other clients until you press the keybind.\ndoThing(keybindState)\nlocal keyA = keybinds:newKeybind("KeybindName", "key.keyboard.k")\nfunction keyA.press()\n    keybindState = not keybindState\n    -- We still need to call the ping function in the keybind.\n    pings.doThing(keybindState)\nend\n')),(0,i.kt)("p",null,"The alternative is to reiterate the ",(0,i.kt)("code",null,"models.modelA:setVisible(state) models.modelB:setVisible(not state)")," part of the ping.",(0,i.kt)("br",null),"\nFor larger pings it will be combersome to rewrite code that is already defined, which is why this technique is useful."),(0,i.kt)("h3",{id:"byte-array"},"Byte Array"),(0,i.kt)("p",null,"There are some situations where you will want to send a large amount of raw bytes, and you need to do it efficiently. The most efficient way is to send a string."),(0,i.kt)("p",null,"Asside from the 2 constant bytes for the length, a string will always be 1 byte per ascii character (UTF-8 characters are multiple ascii characters, interpreted as a single character). This makes it very consistent in terms of bytes, making it easy to predict and avoid being rate limited. "),(0,i.kt)("p",null,"Below is a basic conversion of a byte array to a string, ready to be pinged and converted back into a byte array on the client's end."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-lua"},'function pings.recieveData(str)\n    local byteArray = table.pack(string.byte(str))\n    printTable(byteArray)\nend\n\nlocal packet=[]\nfor i=1,20 do\n    table.insert(packet, math.random(0,255))\nend\nlocal keyA = keybinds:newKeybind("KeybindName", "key.keyboard.k")\nfunction keyA.press()\n    local packedString = string.char(table.unpack(packet))\n    pings.recieveData(packedString)\nend\n\n')))}h.isMDXComponent=!0}}]);